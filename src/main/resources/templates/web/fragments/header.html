<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<header id="header" class="header header-sticky header-sticky-smart disable-transition-all z-index-5"
th:fragment="header">
    <div class="sticky-area">
        <div class="main-header nav navbar bg-body navbar-light navbar-expand-xl py-6 py-xl-0">
            <div class="container-wide container flex-nowrap">
                <div class="w-72px d-flex d-xl-none">
                    <button class="navbar-toggler align-self-center  border-0 shadow-none px-0 canvas-toggle p-4"
                            type="button" data-bs-toggle="offcanvas" data-bs-target="#offCanvasNavBar"
                            aria-controls="offCanvasNavBar" aria-expanded="false" aria-label="Toggle Navigation">
                        <span class="fs-24 toggle-icon"></span>
                    </button>
                </div>

                <div class="w-xl-50 mx-auto">

                    <a href="/home" class="navbar-brand px-0 py-4 mx-auto">
                        <img class="light-mode-img" src="/assets/images/others/logo-black-02.png" width="179"
                             height="48" alt="Glowing - Bootstrap 5 HTML Templates">
                        <img class="dark-mode-img" src="/assets/images/others/logo-white-02.png" width="179"
                             height="48" alt="Glowing - Bootstrap 5 HTML Templates"></a>

                </div>
                <ul class="d-none d-xl-flex navbar-nav">
                    <li
                            class="nav-item transition-all-xl-1 py-xl-11 py-0 mx-xl-7 dropdown dropdown-hover dropdown-fullwidth">
                        <!--<a class="nav-link d-flex justify-content-between position-relative py-xl-0 px-xl-0 text-uppercase fw-semibold ls-1 fs-15px fs-xl-14px dropdown-toggle"
                           href="index-2.html" data-bs-toggle="dropdown" id="menu-item-home" aria-haspopup="true"
                           aria-expanded="false">Home</a>-->
                        <a class="nav-link d-flex justify-content-between position-relative py-xl-0 px-xl-0 text-uppercase fw-semibold ls-1 fs-15px fs-xl-14px "
                           href="/home" id="menu-item-home" aria-haspopup="true"
                           aria-expanded="false">Home</a>
                    </li>
                    <li
                            class="nav-item transition-all-xl-1 py-xl-11 py-0 mx-xl-7 dropdown dropdown-hover dropdown-fullwidth position-static">

                        <a class="nav-link d-flex justify-content-between position-relative py-xl-0 px-xl-0 text-uppercase fw-semibold ls-1 fs-15px fs-xl-14px "
                           href="/home/shop" id="menu-item-shop" aria-haspopup="true"
                           aria-expanded="false">Shop</a>
                    </li>
                    <li class="nav-item transition-all-xl-1 py-xl-11 py-0 mx-xl-7 dropdown dropdown-hover">
                        <a class="nav-link d-flex justify-content-between position-relative py-xl-0 px-xl-0 text-uppercase fw-semibold ls-1 fs-15px fs-xl-14px dropdown-toggle"
                           href="#" data-bs-toggle="dropdown" id="menu-item-pages" aria-haspopup="true"
                           aria-expanded="false">Pages</a>
                        <ul class="dropdown-menu py-6" aria-labelledby="menu-item-pages">
                            <li class="dropend dropdown-hover" aria-haspopup="true" aria-expanded="false">
                                <!--<a class="dropdown-item pe-6 dropdown-toggle d-flex justify-content-between border-hover"
                                   href="#" data-bs-toggle="dropdown" id="menu-item-about-us">-->
                                <a class="dropdown-item pe-6 d-flex justify-content-between border-hover"
                                   href="#" data-bs-toggle="dropdown" id="menu-item-about-us">
										<span class="border-hover-target">
											About Us
										</span>
                                </a>
                            </li>
                            <li class="dropend dropdown-hover" aria-haspopup="true" aria-expanded="false">

                                <a class="dropdown-item pe-6 d-flex justify-content-between border-hover"
                                   href="#" data-bs-toggle="dropdown" id="menu-item-contact-us">
										<span class="border-hover-target">
											Contact us
										</span>
                                </a>

                            </li>

                            <li>
                                <a class="dropdown-item pe-6 border-hover" href="faqs.html">
										<span class="border-hover-target">
											FAQs
										</span>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item pe-6 border-hover" href="find-a-store.html">
										<span class="border-hover-target">
											Store
										</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div class="icons-actions d-flex justify-content-end w-xl-50 fs-28px text-body-emphasis">
                    <div class="px-xl-5 d-inline-block">
                        <a class="lh-1 color-inherit text-decoration-none" href="#" data-bs-toggle="offcanvas"
                           data-bs-target="#searchModal" aria-controls="searchModal" aria-expanded="false">
                            <svg class="icon icon-magnifying-glass-light">
                                <use xlink:href="#icon-magnifying-glass-light"></use>
                            </svg>
                        </a>
                    </div>

                    <div class="color-modes position-relative ps-5 px-5 d-none d-xl-inline-block">
                        <a class="bd-theme btn btn-link nav-link dropdown-toggle d-inline-flex align-items-center justify-content-center text-primary p-0 position-relative rounded-circle"
                           href="#" aria-expanded="true" data-bs-toggle="dropdown" data-bs-display="static"
                           aria-label="Toggle theme (light)">
                            <svg class="bi my-1 theme-icon-active">
                                <use href="#sun-fill"></use>
                            </svg>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end fs-14px" data-bs-popper="static">
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center active"
                                        data-bs-theme-value="light" aria-pressed="true">
                                    <svg class="bi me-4 opacity-50 theme-icon">
                                        <use href="#sun-fill"></use>
                                    </svg>
                                    Light
                                    <svg class="bi ms-auto d-none">
                                        <use href="#check2"></use>
                                    </svg>
                                </button>
                            </li>
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center"
                                        data-bs-theme-value="dark" aria-pressed="false">
                                    <svg class="bi me-4 opacity-50 theme-icon">
                                        <use href="#moon-stars-fill"></use>
                                    </svg>
                                    Dark
                                    <svg class="bi ms-auto d-none">
                                        <use href="#check2"></use>
                                    </svg>
                                </button>
                            </li>
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center"
                                        data-bs-theme-value="auto" aria-pressed="false">
                                    <svg class="bi me-4 opacity-50 theme-icon">
                                        <use href="#circle-half"></use>
                                    </svg>
                                    Auto
                                    <svg class="bi ms-auto d-none">
                                        <use href="#check2"></use>
                                    </svg>
                                </button>
                            </li>
                        </ul>
                    </div>

                    <div class="px-5 d-none d-xl-inline-block">
                        <a class="position-relative lh-1 color-inherit text-decoration-none"
                           href="wishlist.html">
                            <svg class="icon icon-star-light">
                                <use xlink:href="#icon-star-light"></use>
                            </svg>
                        </a>
                    </div>
                    <div class="px-5 d-none d-xl-inline-block">
                        <a class="position-relative lh-1 color-inherit text-decoration-none" href="/home/shopping-cart" aria-controls="shoppingCart" aria-expanded="false">
                            <svg class="icon icon-star-light">
                                <use xlink:href="#icon-shopping-bag-open-light"></use>
                            </svg>
                        </a>
                    </div>

                    <div class="px-5 d-none d-xl-inline-block" id="button-login">
                        <a class="lh-1 color-inherit text-decoration-none" href="#" data-bs-toggle="modal"
                           data-bs-target="#signInModal">
                            <svg class="icon icon-user-light">
                                <use xlink:href="#icon-user-light"></use>
                            </svg>
                        </a>
                    </div>

                    <div class="dropdown d-none d-xl-inline-block" id="button-profile">
                        <a href="#"
                           class="dropdown-toggle text-heading pr-3 pr-sm-6 d-flex align-items-center justify-content-end dropdown px-5 d-none d-xl-inline-block"
                           data-bs-toggle="dropdown">
                            <img th:src="@{/home/files/{filename}(filename=${avatar != null ? avatar : 'default-avatar.jpg'})}"
                                    id="avatar_small"
                                 class="rounded-circle" width="35">
<!--                            <svg class="rounded-circle" alt="Ronald Hunter" id="avatar" width="35" height="35"></svg>-->
                        </a>
                        <div class="dropdown-menu dropdown-menu-end w-100">
                            <a class="dropdown-item" href="/home/profile">My Profile</a>
                            <a class="dropdown-item" href="/account/orders">My Order</a>
                            <a class="dropdown-item" href="#" onclick="logout()">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function logout() {
            console.log('Đang thực hiện đăng xuất...');
            $.ajax({
                url: '/api/logout', // Endpoint xử lý logout
                type: 'POST',   // Phương thức HTTP
                success: function (response) {
                    localStorage.clear(); // Xóa localStorage
                    window.location.href = "/login"; // Chuyển hướng đến trang login
                },
                error: function (xhr, status, error) {
                    alert('Logout failed: ' + xhr.responseText); // Thông báo lỗi
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            $.ajax({
                type: 'GET', // HTTP method
                url: '/api/me', // API endpoint
                dataType: 'json', // Expected response data type
                contentType: 'application/json; charset=utf-8', // Content type
                beforeSend: function (xhr) {
                    // Add authorization header if token exists in localStorage
                    if (localStorage.token) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                    }
                },
                success: function (data) {
                    if (data.avatar) {
                        // Thay đổi thuộc tính src của thẻ img
                        $('#avatar_small').attr('src', `/home/files/${data.avatar}`);
                    }
                },
                error: function (e) {
                    // Handle errors
                    const json = e.responseText;
                    console.error(json);
                }
            });
        });


    </script>

    <style>
        #avatar, #avatar_2 {
            border-radius: 50%; /* Makes the SVG element circular */
            border: 1px solid #000; /* Adds a black border of 2px thickness */
            padding: 3px; /* Optional: adds space between the border and the content */
        }

        #avatar_small {
            height: 35px;
            width: 35px !important;
            object-fit: cover; /* Đảm bảo ảnh không méo, vừa khung */
        }
    </style>
</header>